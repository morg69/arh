# Лабораторная работа №2: резервное копирование, восстановление и мониторинг в Debian и PostgreSQL

**Цель:** Изучить способы резервного копирования баз данных PostgreSQL и восстановления
их в среде Debian. Освоить базовые инструменты мониторинга системы и сервиса
PostgreSQL.

---

## 1. Утилиты резервного копирования

- pg_dump(тип копии) — логическое резервное копирование базы данных.
- pg_basebackup — физическое резервное копирование всего кластера PostgreSQL.

---

## 2. Создание резервной копии

![](src/2.png)

- обычный sql
- Fc - меньше размер \ можно восстанавливать выборочно

- Ft - архив

## 3. Частичное (выборочное) резервное копирование

`pg_dump -U postgres -p 5433 -t public.students -Fc dbhalilov_maksim -f /home/maks/backups/public_tables.dump`

`pg_dump -U postgres -p 5433 -n test_schema -Fc dbhalilov_maksim -f /home/maks/backups/test_schema.dump`

![](src/3.1.png)

---

## 4. Восстановление из резервной копии

![](src/3.png)

## 5. Автоматизация бэкапов с помощью cron

![](src/5.png)

- Ротация удаление стрых файлов чтобы не было накоптельного эффекта
  `find /home/maks/backups -type f -mtime +7 -delete`

## 6. Мониторинг состояния системы

- установка пакетов

  ![](src/6.png)

- top болеее удобная версия
  ![](src/9.png)
- iotop
  ![](src/io.png)

## 7. Мониторинг PostgreSQL

- Смотрим все активные подключения и запросы

![](src/7.png)

- Ищем запросы, выполняющиеся дольше 5 минут

![](src/7.2.png)

- результат

![](src/7.3.png)

## 8. Логирование и анализ логов

- Системные логи Debian - Запуск/остановка сервисов, ошибки ОС, проблемы с дисками

- Логи PostgreSql - Подключения, запросы, ошибки SQL

![](src/10.png)

- создание ошибочного лога

![](src/8.png)
